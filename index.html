<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ›¸ç±ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        nav {
            background: white;
            padding: 0;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            gap: 0;
        }

        nav button {
            flex: 1;
            padding: 12px;
            border: none;
            background: #f0f0f0;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }

        nav button.active {
            background: white;
            border-bottom: 3px solid #667eea;
        }

        .content {
            display: none;
        }

        .content.active {
            display: block;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .card h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-success {
            background: #51cf66;
            color: white;
        }

        .alert {
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: none;
        }

        .alert.show {
            display: block;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .book-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .book-card {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
        }

        .book-card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .book-info {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
            line-height: 1.5;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        table th {
            background: #f0f0f0;
            padding: 10px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #ddd;
        }

        table td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 400px;
            width: 90%;
        }

        .modal-header {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-actions button {
            flex: 1;
        }

        .pagination {
            display: flex;
            gap: 5px;
            justify-content: center;
            margin-top: 15px;
        }

        .pagination button {
            padding: 5px 10px;
            min-width: 35px;
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>ğŸ“š æ›¸ç±ç®¡ç†</h1>
        <div id="userInfo" style="display: none;">
            <span id="userName" style="margin-right: 15px;"></span>
            <button class="btn-secondary" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>
    </header>

    <div id="alert" class="alert"></div>

    <nav id="nav" style="display: none;">
        <button class="nav-btn active" onclick="switchTab('books')">æ›¸ç±ä¸€è¦§</button>
        <button class="nav-btn" onclick="switchTab('rental')">è²¸å‡ºãƒ»è¿”å´</button>
        <button class="nav-btn" onclick="switchTab('history')">å±¥æ­´</button>
        <button class="nav-btn" onclick="switchTab('profile')">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</button>
        <button class="nav-btn" id="adminBtn" onclick="switchTab('admin')" style="display: none;">ç®¡ç†</button>
    </nav>

    <!-- æ›¸ç±ä¸€è¦§ -->
    <div id="books" class="content active">
        <div class="card">
            <h2>æ›¸ç±ä¸€è¦§</h2>
            <div class="book-list" id="bookList"></div>
            <div class="pagination" id="pagination"></div>
        </div>
    </div>

    <!-- è²¸å‡ºãƒ»è¿”å´ -->
    <div id="rental" class="content">
        <div class="card">
            <h2>æ›¸ç±ã‚’è²¸å‡º</h2>
            <div class="form-group">
                <label>ISBN</label>
                <input type="text" id="rentalIsbn">
            </div>
            <button class="btn-primary" onclick="rentalBook()">è²¸å‡º</button>
        </div>

        <div class="card">
            <h2>è¿”å´å¾…æ©Ÿä¸­</h2>
            <table>
                <thead><tr><th>æ›¸ç±</th><th>è²¸å‡ºæ—¥</th><th>è¿”å´æœŸé™</th><th>æ“ä½œ</th></tr></thead>
                <tbody id="activeRentals"></tbody>
            </table>
        </div>
    </div>

    <!-- å±¥æ­´ -->
    <div id="history" class="content">
        <div class="card">
            <h2>å€Ÿã‚Šå‡ºã—å±¥æ­´</h2>
            <table>
                <thead><tr><th>æ›¸ç±</th><th>è²¸å‡ºæ—¥</th><th>è¿”å´æœŸé™</th><th>è¿”å´æ—¥</th></tr></thead>
                <tbody id="historyBody"></tbody>
            </table>
        </div>
    </div>

    <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« -->
    <div id="profile" class="content">
        <div class="card">
            <h2>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</h2>
            <div class="form-group">
                <label>ãƒ¡ãƒ¼ãƒ«</label>
                <input type="email" id="profileEmail" disabled>
            </div>
            <div class="form-group">
                <label>åå‰</label>
                <input type="text" id="profileName">
            </div>
            <button class="btn-primary" onclick="updateProfile()">ä¿å­˜</button>
        </div>
    </div>

    <!-- ç®¡ç†æ©Ÿèƒ½ -->
    <div id="admin" class="content">
        <div class="card">
            <h2>è‘—è€…ç®¡ç†</h2>
            <div class="form-group">
                <label>è‘—è€…å</label>
                <input type="text" id="authorName">
            </div>
            <button class="btn-primary" onclick="createAuthor()">è¿½åŠ </button>
        </div>

        <div class="card">
            <h2>å‡ºç‰ˆç¤¾ç®¡ç†</h2>
            <div class="form-group">
                <label>å‡ºç‰ˆç¤¾å</label>
                <input type="text" id="publisherName">
            </div>
            <button class="btn-primary" onclick="createPublisher()">è¿½åŠ </button>
        </div>

        <div class="card">
            <h2>æ›¸ç±ç®¡ç†</h2>
            <div class="form-group">
                <label>ISBN</label>
                <input type="text" id="bookIsbn">
            </div>
            <div class="form-group">
                <label>ã‚¿ã‚¤ãƒˆãƒ«</label>
                <input type="text" id="bookTitle">
            </div>
            <div class="form-group">
                <label>è‘—è€…ID</label>
                <input type="text" id="bookAuthorId">
            </div>
            <div class="form-group">
                <label>å‡ºç‰ˆç¤¾ID</label>
                <input type="text" id="bookPublisherId">
            </div>
            <div class="form-group">
                <label>å‡ºç‰ˆå¹´</label>
                <input type="number" id="bookYear" min="1900" max="2100">
            </div>
            <div class="form-group">
                <label>å‡ºç‰ˆæœˆ</label>
                <input type="number" id="bookMonth" min="1" max="12">
            </div>
            <button class="btn-primary" onclick="createBook()">è¿½åŠ </button>
        </div>
    </div>
</div>

<!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="loginModal" class="modal show">
    <div class="modal-content">
        <div class="modal-header">ãƒ­ã‚°ã‚¤ãƒ³</div>
        <div id="loginAlert" class="alert"></div>
        <div class="form-group">
            <label>ãƒ¡ãƒ¼ãƒ«</label>
            <input type="email" id="loginEmail">
        </div>
        <div class="form-group">
            <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
            <input type="password" id="loginPassword">
        </div>
        <div class="modal-actions">
            <button class="btn-primary" onclick="login()">ãƒ­ã‚°ã‚¤ãƒ³</button>
            <button class="btn-secondary" onclick="showRegister()">ç™»éŒ²</button>
        </div>
    </div>
</div>

<!-- ç™»éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="registerModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">æ–°è¦ç™»éŒ²</div>
        <div id="registerAlert" class="alert"></div>
        <div class="form-group">
            <label>ãƒ¡ãƒ¼ãƒ«</label>
            <input type="email" id="registerEmail">
        </div>
        <div class="form-group">
            <label>åå‰</label>
            <input type="text" id="registerName">
        </div>
        <div class="form-group">
            <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
            <input type="password" id="registerPassword">
        </div>
        <div class="form-group">
            <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèª</label>
            <input type="password" id="registerPasswordConfirm">
        </div>
        <div class="modal-actions">
            <button class="btn-primary" onclick="register()">ç™»éŒ²</button>
            <button class="btn-secondary" onclick="showLogin()">æˆ»ã‚‹</button>
        </div>
    </div>
</div>

<script>
    const API = 'http://localhost:3000';
    let user = null;
    let token = null;

    window.addEventListener('load', function() {
        token = localStorage.getItem('token');
        user = JSON.parse(localStorage.getItem('user') || 'null');
        if (token && user) {
            showApp();
        }
    });

    function showAlert(id, msg, type) {
        const el = document.getElementById(id);
        el.textContent = msg;
        el.className = 'alert show alert-' + type;
        setTimeout(function() {
            el.classList.remove('show');
        }, 4000);
    }

    function login() {
        const email = document.getElementById('loginEmail').value.trim();
        const password = document.getElementById('loginPassword').value.trim();

        if (!email || !password) {
            showAlert('loginAlert', 'å…¥åŠ›ã—ã¦ãã ã•ã„', 'danger');
            return;
        }

        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
        const loginBtn = event.target;
        const originalText = loginBtn.textContent;
        loginBtn.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³ä¸­...';
        loginBtn.disabled = true;

        console.log('Login attempting to:', API + '/user/login');

        fetch(API + '/user/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email, password })
        })
            .then(res => {
                console.log('Response status:', res.status);
                console.log('Response headers:', res.headers);
                if (!res.ok) {
                    return res.json().then(data => {
                        throw new Error(data.message || `HTTP Error: ${res.status}`);
                    });
                }
                return res.json();
            })
            .then(data => {
                console.log('Login successful:', data);
                if (!data.accessToken) throw new Error('ãƒˆãƒ¼ã‚¯ãƒ³ãŒå–å¾—ã§ãã¾ã›ã‚“');

                token = data.accessToken;
                user = data.user;
                localStorage.setItem('token', token);
                localStorage.setItem('user', JSON.stringify(user));
                showAlert('loginAlert', 'ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼', 'success');
                setTimeout(showApp, 500);
            })
            .catch(e => {
                console.error('Login error details:', e);
                showAlert('loginAlert', e.message || 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ', 'danger');
            })
            .finally(() => {
                loginBtn.textContent = originalText;
                loginBtn.disabled = false;
            });
    }

    function register() {
        const email = document.getElementById('registerEmail').value.trim();
        const name = document.getElementById('registerName').value.trim();
        const password = document.getElementById('registerPassword').value.trim();
        const confirm = document.getElementById('registerPasswordConfirm').value.trim();

        if (!email || !name || !password) {
            showAlert('registerAlert', 'å…¥åŠ›ã—ã¦ãã ã•ã„', 'danger');
            return;
        }
        if (!email.includes('@')) {
            showAlert('registerAlert', 'æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'danger');
            return;
        }
        if (password !== confirm) {
            showAlert('registerAlert', 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“', 'danger');
            return;
        }
        if (password.length < 6) {
            showAlert('registerAlert', 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯6æ–‡å­—ä»¥ä¸Šã§ã™', 'danger');
            return;
        }

        const registerBtn = event.target;
        const originalText = registerBtn.textContent;
        registerBtn.textContent = 'ç™»éŒ²ä¸­...';
        registerBtn.disabled = true;

        console.log('Register attempting to:', API + '/user/register');

        fetch(API + '/user/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, name, password })
        })
            .then(res => {
                console.log('Response status:', res.status);
                if (!res.ok) {
                    return res.json().then(data => {
                        throw new Error(data.message || `HTTP Error: ${res.status}`);
                    });
                }
                return res.json();
            })
            .then(data => {
                console.log('Register successful:', data);
                showAlert('registerAlert', 'ç™»éŒ²æˆåŠŸï¼ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„', 'success');
                // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
                document.getElementById('registerEmail').value = '';
                document.getElementById('registerName').value = '';
                document.getElementById('registerPassword').value = '';
                document.getElementById('registerPasswordConfirm').value = '';
                setTimeout(showLogin, 2000);
            })
            .catch(e => {
                console.error('Register error details:', e);
                showAlert('registerAlert', e.message || 'ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ', 'danger');
            })
            .finally(() => {
                registerBtn.textContent = originalText;
                registerBtn.disabled = false;
            });
    }

    function logout() {
        localStorage.clear();
        token = null;
        user = null;
        document.getElementById('loginModal').classList.add('show');
        document.getElementById('registerModal').classList.remove('show');
        document.getElementById('userInfo').style.display = 'none';
        document.getElementById('nav').style.display = 'none';
        document.getElementById('loginEmail').value = '';
        document.getElementById('loginPassword').value = '';
    }

    function showApp() {
        document.getElementById('loginModal').classList.remove('show');
        document.getElementById('userInfo').style.display = 'flex';
        document.getElementById('nav').style.display = 'flex';
        document.getElementById('userName').textContent = user.name;
        if (user.isAdmin) document.getElementById('adminBtn').style.display = 'block';
        loadBooks();
    }

    function showLogin() {
        document.getElementById('loginModal').classList.add('show');
        document.getElementById('registerModal').classList.remove('show');
    }

    function showRegister() {
        document.getElementById('loginModal').classList.remove('show');
        document.getElementById('registerModal').classList.add('show');
    }

    function switchTab(name) {
        document.querySelectorAll('.content').forEach(e => e.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(e => e.classList.remove('active'));
        document.getElementById(name).classList.add('active');
        event.target.classList.add('active');

        if (name === 'history') loadHistory();
        if (name === 'rental') loadActiveRentals();
        if (name === 'profile') loadProfile();
    }

    function loadBooks(page) {
        page = page || 1;

        console.log('Loading books, page:', page);

        fetch(API + '/book/list?page=' + page + '&pageSize=12')
            .then(res => {
                console.log('Book list response status:', res.status);
                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}`);
                }
                return res.json();
            })
            .then(data => {
                console.log('Book list data:', data);

                if (!data.books || !Array.isArray(data.books)) {
                    throw new Error('Invalid response format: books is not an array');
                }

                const html = data.books.map(b => {
                    try {
                        return '<div class="book-card">' +
                            '<h3>' + (b.title || 'Unknown') + '</h3>' +
                            '<div class="book-info">' +
                            '<div><strong>è‘—è€…:</strong> ' + (b.author?.name || 'Unknown') + '</div>' +
                            '<div><strong>ISBN:</strong> ' + (b.isbn || 'N/A') + '</div>' +
                            '<div><strong>å‡ºç‰ˆ:</strong> ' + (b.publication_year_month || 'Unknown') + '</div>' +
                            '</div>' +
                            '<button class="btn-primary" onclick="toRental(\'' + b.isbn + '\')" style="width: 100%; padding: 8px;">è²¸å‡º</button>' +
                            '</div>';
                    } catch (err) {
                        console.error('Error rendering book card:', err, b);
                        return '';
                    }
                }).join('');

                document.getElementById('bookList').innerHTML = html || '<p>æ›¸ç±ãŒã‚ã‚Šã¾ã›ã‚“</p>';

                let paging = '';
                const lastPage = data.last_page || 1;
                for (let i = 1; i <= lastPage; i++) {
                    paging += '<button class="btn-' + (i === page ? 'primary' : 'secondary') + '" onclick="loadBooks(' + i + ')">' + i + '</button>';
                }
                document.getElementById('pagination').innerHTML = paging;
            })
            .catch(e => {
                console.error('Load books error:', e);
                showAlert('alert', 'booksèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ' + e.message, 'danger');
                document.getElementById('bookList').innerHTML = '<p>æ›¸ç±ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>';
            });
    }

    function toRental(isbn) {
        document.getElementById('rentalIsbn').value = isbn;
        switchTab('rental');
    }

    function rentalBook() {
        const isbn = document.getElementById('rentalIsbn').value;
        if (!isbn) {
            showAlert('alert', 'ISBNã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'danger');
            return;
        }

        fetch(API + '/book/rental', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify({ bookIsbn: isbn })
        })
            .then(res => res.json())
            .then(data => {
                showAlert('alert', 'è²¸å‡ºå®Œäº†', 'success');
                document.getElementById('rentalIsbn').value = '';
                loadActiveRentals();
            })
            .catch(e => showAlert('alert', e.message, 'danger'));
    }

    function loadActiveRentals() {
        fetch(API + '/user/rental-history', {
            headers: { 'Authorization': 'Bearer ' + token }
        })
            .then(res => {
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                return res.json();
            })
            .then(data => {
                if (!data.history || !Array.isArray(data.history)) {
                    throw new Error('Invalid rental history format');
                }
                const active = data.history.filter(h => !h.returnedDate);
                const html = active.map(r =>
                    '<tr>' +
                    '<td>' + (r.book?.title || 'Unknown') + '</td>' +
                    '<td>' + new Date(r.checkoutDate).toLocaleDateString('ja-JP') + '</td>' +
                    '<td>' + new Date(r.dueDate).toLocaleDateString('ja-JP') + '</td>' +
                    '<td><button class="btn-success" onclick="returnBook(\'' + r.id + '\')">è¿”å´</button></td>' +
                    '</tr>'
                ).join('');
                document.getElementById('activeRentals').innerHTML = html || '<tr><td colspan="4">è¿”å´å¾…æ©Ÿä¸­ã®æ›¸ç±ã¯ã‚ã‚Šã¾ã›ã‚“</td></tr>';
            })
            .catch(e => {
                console.error('Load active rentals error:', e);
                showAlert('alert', 'è¿”å´å¾…æ©Ÿä¸­æ›¸ç±ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ' + e.message, 'danger');
            });
    }

    function returnBook(id) {
        fetch(API + '/book/return', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify({ rentalId: id })
        })
            .then(res => res.json())
            .then(data => {
                showAlert('alert', 'è¿”å´å®Œäº†', 'success');
                loadActiveRentals();
            })
            .catch(e => showAlert('alert', e.message, 'danger'));
    }

    function loadHistory() {
        fetch(API + '/user/rental-history', {
            headers: { 'Authorization': 'Bearer ' + token }
        })
            .then(res => {
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                return res.json();
            })
            .then(data => {
                if (!data.history || !Array.isArray(data.history)) {
                    throw new Error('Invalid history format');
                }
                const html = data.history.map(r =>
                    '<tr>' +
                    '<td>' + (r.book?.title || 'Unknown') + '</td>' +
                    '<td>' + new Date(r.checkoutDate).toLocaleDateString('ja-JP') + '</td>' +
                    '<td>' + new Date(r.dueDate).toLocaleDateString('ja-JP') + '</td>' +
                    '<td>' + (r.returnedDate ? new Date(r.returnedDate).toLocaleDateString('ja-JP') : '-') + '</td>' +
                    '</tr>'
                ).join('');
                document.getElementById('historyBody').innerHTML = html || '<tr><td colspan="4">å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
            })
            .catch(e => {
                console.error('Load history error:', e);
                showAlert('alert', 'å±¥æ­´èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ' + e.message, 'danger');
            });
    }

    function loadProfile() {
        document.getElementById('profileEmail').value = user.email;
        document.getElementById('profileName').value = user.name;
    }

    function updateProfile() {
        const name = document.getElementById('profileName').value;
        if (!name) {
            showAlert('alert', 'åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'danger');
            return;
        }

        fetch(API + '/user/profile', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify({ name })
        })
            .then(res => res.json())
            .then(data => {
                user.name = name;
                localStorage.setItem('user', JSON.stringify(user));
                document.getElementById('userName').textContent = name;
                showAlert('alert', 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°å®Œäº†', 'success');
            })
            .catch(e => showAlert('alert', e.message, 'danger'));
    }

    function createAuthor() {
        const name = document.getElementById('authorName').value;
        if (!name) {
            showAlert('alert', 'è‘—è€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'danger');
            return;
        }

        fetch(API + '/admin/author', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify({ name })
        })
            .then(res => res.json())
            .then(data => {
                showAlert('alert', 'è‘—è€…ã‚’è¿½åŠ ã—ã¾ã—ãŸ', 'success');
                document.getElementById('authorName').value = '';
            })
            .catch(e => showAlert('alert', e.message, 'danger'));
    }

    function createPublisher() {
        const name = document.getElementById('publisherName').value;
        if (!name) {
            showAlert('alert', 'å‡ºç‰ˆç¤¾åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'danger');
            return;
        }

        fetch(API + '/admin/publisher', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify({ name })
        })
            .then(res => res.json())
            .then(data => {
                showAlert('alert', 'å‡ºç‰ˆç¤¾ã‚’è¿½åŠ ã—ã¾ã—ãŸ', 'success');
                document.getElementById('publisherName').value = '';
            })
            .catch(e => showAlert('alert', e.message, 'danger'));
    }

    function createBook() {
        const isbn = document.getElementById('bookIsbn').value;
        const title = document.getElementById('bookTitle').value;
        const authorId = document.getElementById('bookAuthorId').value;
        const publisherId = document.getElementById('bookPublisherId').value;
        const year = document.getElementById('bookYear').value;
        const month = document.getElementById('bookMonth').value;

        if (!isbn || !title || !authorId || !publisherId || !year || !month) {
            showAlert('alert', 'ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„', 'danger');
            return;
        }

        fetch(API + '/admin/book', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify({
                isbn: isbn,
                title: title,
                authorId: authorId,
                publisherId: publisherId,
                publicationYear: parseInt(year),
                publicationMonth: parseInt(month)
            })
        })
            .then(res => res.json())
            .then(data => {
                showAlert('alert', 'æ›¸ç±ã‚’è¿½åŠ ã—ã¾ã—ãŸ', 'success');
                document.getElementById('bookIsbn').value = '';
                document.getElementById('bookTitle').value = '';
                document.getElementById('bookAuthorId').value = '';
                document.getElementById('bookPublisherId').value = '';
                document.getElementById('bookYear').value = '';
                document.getElementById('bookMonth').value = '';
            })
            .catch(e => showAlert('alert', e.message, 'danger'));
    }
</script>
</body>
</html>